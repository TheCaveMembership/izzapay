<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>IZZA PAY — Sign in with Pi</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <link rel="stylesheet" href="/static/themes.css">
  <style>
    html,body{max-width:100%;overflow-x:hidden}
    :root{
      --bg:#000; --txt:#e8f1ff; --muted:#9fb0d6; --line:#1d2540;
      --piPurple1:#7a44ff; --piPurple2:#b784ff;
      --gold1:#ffcf4d; --gold2:#ffb23a;
      --glow-gold:0 0 26px rgba(255,207,77,.45), 0 0 64px rgba(255,178,58,.25);
      --glow-purple:0 0 28px rgba(183,132,255,.35), 0 0 64px rgba(122,68,255,.25);
      --ring:0 0 0 2px rgba(183,132,255,.28);
      --dim:#5f6d90;
    }
    body{
      font-family:Inter,Arial,Helvetica,sans-serif;background:#000;color:var(--txt);margin:0;
      text-align:center; /* center all text by default */
    }
    .wrap{max-width:1100px;margin:0 auto;padding:16px 16px 160px}
    @media (min-width:720px){ .wrap{padding:24px 24px 180px} }
    /* Tighten page bottom spacing */
.wrap{ padding-bottom:40px; }
@media (min-width:720px){ .wrap{ padding-bottom:60px; } }

    /* Top bar: centered BROWSE STORES, no logo */
    .topbar{
  display:flex;align-items:center;justify-content:center;
  padding:12px 0; position:sticky; top:0; z-index:50;
  background:rgba(0,0,0,.9); backdrop-filter:blur(10px); border-bottom:1px solid var(--line);
  gap:12px; /* ← add this */
}

    /* Buttons — Pi purple & gold */
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:14px 18px;border-radius:14px;font-weight:700;letter-spacing:.2px;cursor:pointer;text-decoration:none;
      border:1px solid transparent;transition:transform .15s ease,box-shadow .15s ease,filter .15s ease;
      font-size:clamp(14px,3.7vw,18px); white-space:nowrap;
    }
    .btn:focus-visible{outline:none;box-shadow:var(--ring)}
    .btn:hover{transform:translateY(-1px)} .btn:active{transform:translateY(0)}
    .btn.purple{background:linear-gradient(180deg,var(--piPurple1),var(--piPurple2));color:#fff;box-shadow:var(--glow-purple)}
    .btn.gold{background:linear-gradient(180deg,var(--gold1),var(--gold2));color:#1a1400;box-shadow:var(--glow-gold)}
    .btn.ghost{background:transparent;color:#cfe0ff;border-color:#2a3550}
    .btn.ghost:hover{border-color:#3f4e79}
    .btn.upper{text-transform:uppercase;letter-spacing:.6px}

    /* Headings & copy */
    h1{
      margin:16px 0 6px;
      font-size:clamp(26px,8.5vw,56px); /* stays on one line on phones */
      line-height:1.05; letter-spacing:.4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    h2{margin:28px 0 4px;font-size:22px}
    p{color:var(--muted);margin:8px 0 16px}

    /* Sections */
    .section{padding:18px 0}
    .cta-row{display:flex;justify-content:center;gap:12px;flex-wrap:wrap}

    /* Pills */
    .pillrow{display:flex;justify-content:center;gap:8px;flex-wrap:wrap;margin:10px 0}
    .pill{background:#0b0f1f;border:1px solid #222b4a;color:#cfe0ff;border-radius:999px;padding:6px 10px;font-size:12px}

    /* Side rails + markers */
    .rail{position:fixed;top:0;bottom:0;width:12px;z-index:0;pointer-events:none}
    .rail.left{left:0;background:linear-gradient(180deg,transparent 0%,rgba(255,207,77,.18) 20%,rgba(255,178,58,.2) 55%,transparent 100%)}
    .rail.right{right:0;background:linear-gradient(180deg,transparent 0%,rgba(183,132,255,.16) 20%,rgba(122,68,255,.22) 55%,transparent 100%)}

    .railNav{position:fixed;top:90px;display:flex;flex-direction:column;gap:14px;z-index:2}
    .railNav.left{left:20px} .railNav.right{right:20px}
    .mark{display:flex;align-items:center;gap:10px;color:var(--dim);cursor:pointer;user-select:none;text-decoration:none}
    .mark .dot{width:10px;height:10px;border-radius:50%;background:#222;box-shadow:0 0 0 2px rgba(255,255,255,.04) inset}
    .mark .label{font-size:12px;white-space:nowrap}
    .mark.active .label{color:#fff}
    .mark.gold .dot{background:#3a2a00}
    .mark.purple .dot{background:#2a1f4a}
    .mark.active.gold .dot{background:var(--gold1); box-shadow:0 0 14px 2px rgba(255,207,77,.55)}
    .mark.active.purple .dot{background:var(--piPurple2); box-shadow:0 0 14px 2px rgba(183,132,255,.55)}
    @media (max-width:980px){ .railNav{display:none} }

    /* Reveal */
    .reveal{opacity:0;transform:translateY(18px);transition:opacity .5s ease,transform .5s ease}
    .reveal.show{opacity:1;transform:translateY(0)}

    /* Bigger IZZA PAY logo under hero words */
    .hero-logo{height:clamp(58px,12vw,110px);margin:10px auto 8px;display:block;filter:drop-shadow(0 0 10px rgba(255,255,255,.06))}
/* Reduce space below main button sections */
#s-city {
  margin-bottom: 0;
  padding-bottom: 0;
}

#s-store-cta {
  margin-bottom: 0;
  padding-bottom: 0;
}

#s-store-cta .cta-row {
  margin-bottom: 6px; /* optional fine-tune */
}

#s-city .cta-row {
  margin-bottom: 6px; /* optional fine-tune */
}
    /* Mobile: nudge the IZZA PAY logo to the right */
@media (max-width: 768px){
  #s-hero .hero-logo{
    display:block;
    margin:10px auto 8px;     /* keeps it centered baseline */
    transform: translateX(91px);  /* push right; tweak 8–24px as you like */
  }
}
    /* ↑↑↑ END ADDITION ↑↑↑ */
  </style>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
  <!-- electrified rails -->
  <div class="rail left"  id="railL" aria-hidden="true"></div>
  <div class="rail right" id="railR" aria-hidden="true"></div>

  <!-- LEFT rail markers (Play loop) -->
  <nav class="railNav left" aria-label="IZZA Play Steps">
    <a class="mark gold"   data-target="#s-city"><span class="dot"></span><span class="label">IZZA City</span></a>
    <a class="mark gold"   data-target="#s-arcade"><span class="dot"></span><span class="label">IZZA Arcade</span></a>
    <a class="mark gold"   data-target="#s-build"><span class="dot"></span><span class="label">Build Character</span></a>
    <a class="mark gold"   data-target="#s-craft"><span class="dot"></span><span class="label">Craft Items</span></a>
    <a class="mark gold"   data-target="#s-missions"><span class="dot"></span><span class="label">Missions</span></a>
    <a class="mark gold"   data-target="#s-battles"><span class="dot"></span><span class="label">Multiplayer Battles</span></a>
  </nav>

  <!-- RIGHT rail markers (Pay loop) -->
  <nav class="railNav right" aria-label="IZZA Pay Steps">
    <a class="mark purple" data-target="#s-store-cta"><span class="dot"></span><span class="label">My Store & Transactions</span></a>
    <a class="mark purple" data-target="#s-sell"><span class="dot"></span><span class="label">Sell Any Item</span></a>
    <a class="mark purple" data-target="#s-custom"><span class="dot"></span><span class="label">Customize Store</span></a>
    <a class="mark purple" data-target="#s-collect"><span class="dot"></span><span class="label">Crafted Collectibles</span></a>
  </nav>

  <div class="wrap">
    <!-- Topbar (centered BROWSE STORES, no logo) -->
    <div class="topbar">
  <a class="btn ghost upper" href="/explore">BROWSE STORES</a>
  <a class="btn purple upper" href="/token/izza" aria-label="View IZZA Token Showcase">IZZA TOKEN</a>
</div>

    <!-- HERO -->
    <section class="section" id="s-hero">
      <h1 class="reveal">BUILD • SELL • PLAY</h1>
      <img src="/static/izzapay-word.svg" alt="IZZA PAY" class="hero-logo reveal">
      <p class="reveal">Craft AI-SVG items, mint as digital collectibles, and get paid in Pi. Buyers equip items in-game — from damage-reducing armor to fully automatic guns. Your creativity powers the IZZA ecosystem.</p>

      <div class="pillrow reveal">
        <span class="pill">Pi SDK v2</span>
        <span class="pill">99% to merchant</span>
        <span class="pill">IZZA API</span>
      </div>

      <!-- TOP ROW (City + Arcade) -->
      <div class="cta-row reveal" id="s-city">
        <a class="btn purple" href="/izza-game/auth?dest=city" aria-label="IZZA CITY">IZZA CITY</a>
        <a class="btn gold"   href="/izza-game/auth?dest=minigames" aria-label="IZZA ARCADE" id="s-arcade">IZZA ARCADE</a>
      </div>
    </section>

    <!-- PLAY LOOP DETAILS -->
    <section class="section">
      <div class="reveal" id="s-build">
        <h2>Build your character</h2>
        <p>Level up skills, choose loadouts, and prepare for challenges across IZZA City & Arcade.</p>
      </div>
      <div class="reveal" id="s-craft">
        <h2>Craft items</h2>
        <p>Earn Crafting Credits and IZZA Coins, generate AI-SVG items, and forge armor, weapons, and apparel to fully customize your avatar.</p>
      </div>
      <div class="reveal" id="s-missions">
        <h2>Complete missions</h2>
        <p>Story missions and arcade objectives feed your crafting loop and unlock rare blueprints.</p>
      </div>
      <div class="reveal" id="s-battles">
        <h2>Multiplayer battles</h2>
        <p>Compete to set records — including longest police chase in IZZA City — and climb global leaderboards.</p>
      </div>
    </section>

    <!-- STORE CTA ROW (above Sell Any Item) -->
    <section class="section" id="s-store-cta">
      <div class="cta-row reveal">
        <button id="piSignInBtn_clone" class="btn purple">MY STORE</button>
        <a class="btn gold" href="/orders">TRANSACTIONS</a>
      </div>
      <p id="msg" class="reveal" style="margin-top:8px;color:var(--muted)"></p>
      <div id="err" style="color:#ff9aa2;white-space:pre-wrap"></div>
    </section>

    <!-- PAY LOOP DETAILS -->
    <section class="section">
      <div class="reveal" id="s-sell">
        <h2>Sell any item through your store</h2>
        <p>List physical goods or your crafted digital items and accept Pi instantly through IZZA PAY.</p>
      </div>
      <div class="reveal" id="s-custom">
        <h2>Customize your store</h2>
        <p>Branding, themes, fonts, and pricing in Pi — your storefront launches in minutes.</p>
      </div>
      <div class="reveal" id="s-collect">
        <h2>Add crafted items as digital collectibles</h2>
        <p>Mint game items as collectibles that also grant in-game access for buyers across City & Arcade.</p>
      </div>
    </section>
  </div>

  <!-- Pi SDK auth -->
  <script>
  (function(){
    const msg = document.getElementById('msg');
    const err = document.getElementById('err');
    const btnClone = document.getElementById('piSignInBtn_clone'); // "MY STORE"
    const postUrl = "/auth/exchange";
    const sandbox = {{ 'true' if sandbox else 'false' }};

    function setMsg(t){ if(msg) msg.textContent = t || ''; }
    function setErr(t){ if(err) err.textContent = t || ''; }

    function initPi(){
      if (!window.Pi || !Pi.init) return false;
      try { Pi.init({ version:"2.0", sandbox:sandbox }); return true; }
      catch(e){ console.error("Pi.init failed", e); setErr("Pi.init failed: " + (e?.message || e)); return false; }
    }
    if(!initPi()) setMsg("Open in Pi Browser or refresh. Pi SDK is initializing.");

    function doAuth(){
      setErr('');
      if (!window.Pi || !Pi.authenticate){ setMsg("Pi SDK not available. Open in Pi Browser or refresh."); return; }
      setMsg("Requesting authorization…");
      const scopes=['payments','username'];
      function onIncompletePaymentFound(_p){}
      Pi.authenticate(scopes,onIncompletePaymentFound)
        .then(function(auth){
          const form=document.createElement('form'); form.method='POST'; form.action=postUrl;
          const inp=document.createElement('input'); inp.type='hidden'; inp.name='payload';
          inp.value=JSON.stringify({ accessToken:auth.accessToken, user:auth.user });
          form.appendChild(inp); document.body.appendChild(form); form.submit();
        })
        .catch(function(e){ console.error(e); setMsg("Authorization failed. Please try again."); setErr(e?.message||String(e)); });
    }
    btnClone?.addEventListener('click', doAuth);
  })();
  </script>

  <!-- Scroll reveals + rail glow + marker activation -->
  <script>
  (function(){
    const io=new IntersectionObserver((entries)=>{
      entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show'); });
    },{threshold:.15});
    document.querySelectorAll('.reveal').forEach(n=>io.observe(n));

    const L=document.getElementById('railL'), R=document.getElementById('railR');
    function onScroll(){
      const doc=document.documentElement;
      const max=doc.scrollHeight-doc.clientHeight;
      const p=Math.max(0,Math.min(1,(doc.scrollTop||0)/(max||1)));
      const g=8+44*p, a=0.18+0.35*p;
      if(L) L.style.boxShadow=`0 0 ${g}px ${g/6}px rgba(255,207,77,${a})`;
      if(R) R.style.boxShadow=`0 0 ${g}px ${g/6}px rgba(183,132,255,${a})`;
    }
    onScroll(); window.addEventListener('scroll', onScroll, {passive:true});

    const marks=[...document.querySelectorAll('.railNav .mark')];
    marks.forEach(m=>{
      m.addEventListener('click', (e)=>{
        e.preventDefault();
        const sel=m.getAttribute('data-target');
        const el=document.querySelector(sel);
        if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
      });
    });

    const sectionMap = {};
    marks.forEach(m=>{
      const id=m.getAttribute('data-target');
      if(!sectionMap[id]) sectionMap[id]=[];
      sectionMap[id].push(m);
    });
    const activate=(id)=>{
      marks.forEach(x=>x.classList.remove('active'));
      (sectionMap[id]||[]).forEach(x=>x.classList.add('active'));
    };
    const watch = new IntersectionObserver((ents)=>{
      ents.forEach(ent=>{
        if(ent.isIntersecting){
          const id = '#'+ent.target.id;
          activate(id);
        }
      });
    },{rootMargin:'-40% 0px -55% 0px', threshold:.05});

    ['s-city','s-arcade','s-build','s-craft','s-missions','s-battles','s-store-cta','s-sell','s-custom','s-collect']
      .forEach(id=>{
        const el=document.getElementById(id);
        if(el) watch.observe(el);
      });
  })();
  </script>

  <!-- Bottom chips -->
  <script>
  (function(){
    var KEY='izzaLang';
    var choices=[['af','Afrikaans'],['ar','العربية'],['bn','বাংলা'],['bg','Български'],['ca','Català'],
      ['cs','Čeština'],['da','Dansk'],['de','Deutsch'],['el','Ελληνικά'],['en','English'],
      ['es','Español'],['et','Eesti'],['fa','فارسی'],['fi','Suomi'],['fil','Filipino'],
      ['fr','Français'],['gu','ગુજરાતી'],['he','עברית'],['hi','हिन्दी'],['hr','Hrvatski'],
      ['hu','Magyar'],['id','Indonesia'],['it','Italiano'],['ja','日本語'],['kn','ಕನ್ನಡ'],
      ['ko','한국어'],['lt','Lietuvių'],['lv','Latviešu'],['ms','Melayu'],['nl','Nederlands'],
      ['no','Norsk'],['pl','Polski'],['pt','Português'],['ro','Română'],['ru','Русский'],
      ['sk','Slovenčina'],['sl','Slovenščina'],['sv','Svenska'],['ta','தமிழ்'],['te','తెలుగు'],
      ['th','ไทย'],['tr','Türkçe'],['uk','Українська'],['ur','اردو'],['vi','Tiếng Việt'],['zh','中文']];

    function getLang(){ try{ return localStorage.getItem(KEY)||'en'; }catch(_){ return 'en'; } }
    function setLang(v){
      try{
        localStorage.setItem(KEY,v);
        try{ window.dispatchEvent(new CustomEvent('izza-lang-changed',{detail:{lang:v}})); }catch(_){}
        location.reload();
      }catch(_){}
    }

    var wrap=document.createElement('div');
    Object.assign(wrap.style,{position:'fixed',right:'10px',bottom:'10px',zIndex:'9999',display:'flex',gap:'8px',alignItems:'center'});

    var langChip=document.createElement('div');
    Object.assign(langChip.style,{background:'#121827',border:'1px solid #2a3550',borderRadius:'10px',padding:'6px 8px',font:'12px/1.2 system-ui,Arial,sans-serif',color:'#cfe0ff',boxShadow:'0 6px 18px rgba(0,0,0,.35)'});
    var lab=document.createElement('span'); lab.textContent='Language: ';
    var sel=document.createElement('select'); sel.id='hsLang';
    choices.forEach(function(c){ var o=document.createElement('option'); o.value=c[0]; o.textContent=c[1]; sel.appendChild(o); });
    sel.value=getLang(); sel.addEventListener('change',function(){ setLang(this.value); });
    langChip.appendChild(lab); langChip.appendChild(sel);

    var privacyChip=document.createElement('a');
    privacyChip.href='/privacy'; privacyChip.textContent='Privacy';
    Object.assign(privacyChip.style,{
      background:'#121827',border:'1px solid #2a3550',borderRadius:'10px',
      padding:'8px 12px',font:'12px/1.2 system-ui,Arial,sans-serif',color:'#cfe0ff',
      textDecoration:'none',boxShadow:'0 6px 18px rgba(0,0,0,.35)'
    });

    wrap.appendChild(langChip);
    wrap.appendChild(privacyChip);
    document.body.appendChild(wrap);
  })();
  </script>

  <!-- Translation bootstrap (unchanged) -->
  <script>
  window.TRANSLATE_TEXT = async (text, from, to) => {
    try {
      const r = await fetch('/api/translate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text, from, to })
      });
      const j = await r.json();
      return (j && j.ok && typeof j.text === 'string') ? j.text : text;
    } catch { return text; }
  };
  (function(){
    const LANG_KEY='izzaLang';
    const to=(localStorage.getItem(LANG_KEY)||'en').slice(0,5);
    const from=(document.documentElement.getAttribute('lang')||'en').slice(0,5);
    if(typeof window.TRANSLATE_TEXT!=='function'){ window.TRANSLATE_TEXT=async t=>t; }

    const SKIP=new Set(['SCRIPT','STYLE','NOSCRIPT','CODE','PRE','TEXTAREA','INPUT','SELECT','OPTION']);
    function collect(root){
      const nodes=[]; const w=document.createTreeWalker(root,NodeFilter.SHOW_TEXT,{acceptNode(n){
        const p=n.parentElement; if(!p||SKIP.has(p.tagName)) return NodeFilter.FILTER_REJECT;
        const s=n.nodeValue; if(!s||!s.trim()) return NodeFilter.FILTER_REJECT;
        if(p.closest('[data-no-i18n="1"]')) return NodeFilter.FILTER_REJECT;
        return NodeFilter.FILTER_ACCEPT;
      }}); let n; while((n=w.nextNode())) nodes.push(n); return nodes;
    }
    async function translate(nodes){
      for(const n of nodes){
        try{
          const p=n.parentElement, orig=(p?.dataset?.i18nOriginal)||n.nodeValue;
          const out=(to===from)?orig:await window.TRANSLATE_TEXT(orig,from,to);
          if(p&&p.dataset) p.dataset.i18nOriginal=orig;
          if(typeof out==='string'&&out&&out!==n.nodeValue) n.nodeValue=out;
        }catch{}
      }
    }
    async function run(){ await translate(collect(document.body)); }

    const mo=new MutationObserver(muts=>{
      const batch=[]; for(const m of muts){
        if(m.type==='childList'){
          m.addedNodes&&m.addedNodes.forEach(nd=>{
            if(nd.nodeType===1) batch.push(...collect(nd));
            else if(nd.nodeType===3) batch.push(nd);
          });
        } else if(m.type==='characterData'&&m.target&&m.target.nodeType===3){
          batch.push(m.target);
        }
      }
      if(batch.length) translate(batch);
    });

    if(document.readyState==='loading'){
      document.addEventListener('DOMContentLoaded',()=>{ run(); mo.observe(document.body,{childList:true,characterData:true,subtree:true}); },{once:true});
    } else {
      run(); mo.observe(document.body,{childList:true,characterData:true,subtree:true});
    }
  })();
  </script>
</body>
</html>
