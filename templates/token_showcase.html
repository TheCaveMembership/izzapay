<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IZZA Token â€” Testnet Showcase</title>
  <meta name="description" content="IZZA (test) â€” token showcase for IZZA PAY / IZZA Game" />

  <style>
    :root{
      --bg:#050308;
      --panel:#0b0b10;
      --muted:#9aa0b1;
      --accent1:#7a44ff;
      --accent2:#b784ff;
      --glass: rgba(255,255,255,0.04);
      --card-radius:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;

      /* glow palettes */
      --gold: 255,205,96;
      --violet1: 183,132,255;
      --violet2: 122,68,255;
    }

    html,body{
      height:100%;
      margin:0;
      background:#000;
      color:#fff;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      -webkit-font-smoothing:antialiased;
      max-width:100%;
      overflow-x:hidden;
      overscroll-behavior-x:none;
    }
    .wrap{max-width:1000px;margin:0 auto;padding:18px 16px 28px}
    @media (min-width:420px){ .wrap{padding:22px 18px 36px} }
    @media (min-width:820px){ .wrap{padding:28px 24px 42px} }

    header{display:flex;align-items:center;gap:12px;flex-wrap:wrap}

    .logo{
      height:clamp(56px, 12vw, 80px);
      width:auto;
      display:inline-flex;align-items:center;justify-content:center;
      cursor:pointer; user-select:none;
    }
    .logo img{height:100%; width:auto; object-fit:contain; background:transparent;}
    @media (max-width:768px){ .logo{ transform: translateX(91px); } }
    h1{margin:0;font-size:clamp(20px,4.8vw,28px);letter-spacing:.2px}
    p.lead{color:var(--muted);margin:4px 0 0;font-size:clamp(13px,3.4vw,14px)}
    .spacer{flex:1 1 auto}

    /* top-centered CTA just under the logo */
    .top-cta{width:100%;text-align:center;margin-top:8px}
    .cta{
      display:inline-flex;align-items:center;gap:10px;
      padding:12px 16px;border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:linear-gradient(180deg,rgba(122,68,255,.25),rgba(183,132,255,.12));
      box-shadow:0 0 18px rgba(122,68,255,.28), 0 0 60px rgba(183,132,255,.18) inset;
      color:#fff;text-decoration:none;font-weight:800;letter-spacing:.3px;cursor:pointer;
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .cta:hover{transform:translateY(-1px);box-shadow:0 0 26px rgba(122,68,255,.40), 0 0 80px rgba(183,132,255,.28) inset}
    .cta:active{transform:translateY(0)}
    .cta img{width:20px;height:20px}

    .hero{position:relative;margin-top:16px;display:grid;gap:14px;grid-template-columns:1fr}
    @media (min-width:880px){ .hero{grid-template-columns:minmax(0,1fr) 370px; gap:16px} }

    .panel{
      background:var(--panel);
      border:1px solid rgba(255,255,255,.06);
      border-radius:var(--card-radius);
      padding:14px;
      box-shadow:0 4px 30px rgba(0,0,0,.35);
    }
    @media (min-width:540px){ .panel{padding:16px} }
    @media (min-width:980px){ .panel{padding:18px} }

    .token-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}

    /* Coin + GOLD glow beneath it (no box) */
    .token-img{
      width:112px;height:112px;border-radius:14px;
      display:flex;align-items:center;justify-content:center;
      position:relative;isolation:isolate;touch-action:pan-y;
    }
    .token-img img{
      width:100%;height:100%;object-fit:contain;border-radius:14px;backface-visibility:hidden;position:relative;z-index:1;
    }
    /* perfectly centered, SMALLER, and nudged up-left */
    .token-img::before{
      content:"";
      position:absolute;
      top:  calc(50% + var(--pulse-offset-y, -16px));
      left: calc(50% + var(--pulse-offset-x, -36px));
      width: var(--pulse-size, 140px);
      height: var(--pulse-size, 140px);
      transform: translate(-50%, -50%);
      border-radius:50%;
      background: radial-gradient(50% 50% at 50% 50%,
                  rgba(255,210,90,.35) 0%,
                  rgba(255,185,30,.18) 45%,
                  rgba(255,185,30,0) 70%);
      /* softer halo so it reads smaller */
      box-shadow:
        0 0 30px 6px rgba(255,196,56,.40),
        0 0 60px 20px rgba(255,180,0,.22) inset;
      animation: pulse 2.2s ease-in-out infinite;
      z-index: -1;
      pointer-events:none;
    }

    @keyframes coinspin{to{transform:rotateY(720deg)}}
    .spin-anim{animation:coinspin 1.1s ease-in-out}

    .bg-weave{
      position:absolute; inset:-4px; z-index:-1; border-radius:20px;
      background:
        radial-gradient(600px 220px at 10% -10%, rgba(122,68,255,.18), transparent 60%),
        radial-gradient(500px 200px at 110% 10%, rgba(183,132,255,.22), transparent 58%),
        radial-gradient(800px 260px at 50% 120%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      overflow:hidden;
    }
    .bg-weave::after{
      content:""; position:absolute; inset:0;
      background:repeating-linear-gradient(110deg,
        rgba(255,255,255,.04) 0px, rgba(255,255,255,.04) 1px,
        rgba(255,255,255,0) 1px, rgba(255,255,255,0) 8px);
      mix-blend-mode:overlay; animation:drift 12s linear infinite; opacity:.35;
    }
    @keyframes drift{0%{transform:translate3d(-30px,0,0)}100%{transform:translate3d(30px,0,0)}}

    .meta h2{margin:0 0 4px 0;font-size:clamp(18px,4.6vw,22px)}
    .small{color:var(--muted);font-size:clamp(12px,3.2vw,13px)}
    .mono{font-family:var(--mono)}
    .wrapaddr{word-break:break-all; overflow-wrap:anywhere}

    /* pulsing badge beside coin (opens roadmap) */
    .side-badge{
      display:flex;flex-direction:column;align-items:center;gap:8px;
      padding:0;border:none;background:none;
      margin-left:auto;margin-right:20px;margin-top:18px;text-align:center;
      position:relative;top:8px;
    }
    .mark-wrap{
      width:84px;height:84px;border-radius:18px;display:flex;align-items:center;justify-content:center;
      background: radial-gradient(60% 60% at 50% 40%, rgba(var(--violet1),.42), rgba(var(--violet1),.20));
      box-shadow: 0 0 22px rgba(var(--violet1),.45), 0 0 70px rgba(var(--violet2),.32);
      animation:pulse 2.2s ease-in-out infinite;cursor:pointer;border:none;
    }
    .mark-wrap img{width:50px;height:50px;display:block}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.07)}}
    .side-badge .arcade{font-weight:900;letter-spacing:.8px;text-transform:uppercase;font-size:14px;line-height:1.15;text-shadow:0 0 12px rgba(var(--violet1),.35)}
    .side-badge .hint{color:var(--muted);font-size:11px;line-height:1.1}

    .two{margin-top:12px;display:grid;gap:10px;grid-template-columns:1fr 1fr}
    @media (max-width:480px){ .two{grid-template-columns:1fr} }
    .stat{background:var(--glass);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:10px}
    .stat .label{color:var(--muted);font-size:12px}
    .stat strong{display:block;margin-top:4px;font-size:clamp(16px,4.8vw,18px)}

    .card-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .small-muted{color:var(--muted);font-size:13px}

    .grid{display:grid;gap:10px;grid-template-columns:1fr 1fr}
    @media (max-width:480px){ .grid{grid-template-columns:1fr} }
    .mini{display:flex;gap:10px;align-items:center}
    .mini .ico{
      width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;
      background:rgba(255,255,255,.04);font-size:18px;line-height:1;
    }
    .mini .ico.purple{
      background:linear-gradient(180deg,var(--accent1),var(--accent2));
      box-shadow:0 0 10px rgba(183,132,255,.25);
    }
    .mini img{width:26px;height:26px;object-fit:contain}

    hr.sep{margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.06)}
    .lower{margin-top:14px;display:grid;gap:12px;grid-template-columns:1fr}
    @media (min-width:880px){ .lower{grid-template-columns:minmax(0,1fr) 370px} }

    .btnrow{display:flex;gap:8px;flex-wrap:wrap}
    .linkbtn{display:inline-block;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);color:#cfe0ff;text-decoration:none;font-weight:600}

    details.activity{margin-top:12px}
    details.activity > summary{
      list-style:none; cursor:pointer; padding:10px 12px; border-radius:10px;
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); font-weight:600;
    }
    details.activity[open] > summary{background:rgba(255,255,255,.06)}
    .ops{margin-top:10px}
    .op{margin-bottom:10px}
    .op .t{display:block;font-weight:700}
    .op .m{color:var(--muted);font-size:12px;margin-top:4px}

    footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;z-index:999;backdrop-filter:saturate(140%) blur(2px)}
    .modal{position:fixed;inset:0;display:none;z-index:1000;align-items:center;justify-content:center;padding:24px}
    .modal[open], .modal-backdrop[open]{display:flex}
    .modal-card{
      width:min(980px,96vw);max-height:86vh;overflow:auto;border-radius:18px;
      background:linear-gradient(180deg, rgba(10,8,18,.9), rgba(6,5,12,.96));
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 40px 120px rgba(0,0,0,.55), 0 0 80px rgba(122,68,255,.35) inset;
      animation:pop .18s ease-out;
    }
    @keyframes pop{from{transform:translateY(10px) scale(.98);opacity:.6}to{transform:none;opacity:1}}
    .modal-header{
      position:sticky;top:0;z-index:2;display:flex;align-items:center;gap:12px;justify-content:space-between;
      padding:14px 16px;background:rgba(8,6,14,.85);border-bottom:1px solid rgba(255,255,255,.06);backdrop-filter:blur(6px)
    }
    .modal-title{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.4px;text-transform:uppercase}
    .modal-title img{width:26px;height:26px}
    .close-btn{appearance:none;border:none;cursor:pointer;border-radius:10px;padding:8px 10px;font-weight:800;color:#fff;background:rgba(255,255,255,.06)}
    .modal-body{padding:16px}
    .pill{display:inline-block;padding:8px 10px;border-radius:999px;background:linear-gradient(180deg,var(--accent1),var(--accent2));font-size:12px;font-weight:800;letter-spacing:.3px;box-shadow:0 0 16px rgba(183,132,255,.35)}
    .road-grid{display:grid;gap:12px;grid-template-columns:1fr}
    @media (min-width:860px){.road-grid{grid-template-columns:1.2fr .8fr}}
    .blox{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px}
    .blox h4{margin:0 0 8px 0;font-size:16px;letter-spacing:.2px}
    .blox p{margin:6px 0;color:#cfe0ff}
    .list{margin:8px 0 0 0;padding:0 0 0 18px;color:#cfe0ff}
    .list li{margin:6px 0}
    .grid-2{display:grid;gap:10px;grid-template-columns:1fr 1fr}
    .statline{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 10px;border-radius:10px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06)}
    .mini-mark{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--accent1),var(--accent2));box-shadow:0 0 10px rgba(183,132,255,.25)}
    .img-row{display:flex;gap:10px;flex-wrap:wrap}
    .img-row img{width:100px;height:100px;border-radius:12px;object-fit:cover;background:transparent}

    /* center the third economy card (same style, just centered) */
    .center-span{grid-column:1 / -1;justify-self:center;max-width:420px;width:100%}

    /* Reusable roadmap glow chip â€” tune per instance with CSS vars */
    .glow{
      --sz: 92px;
      --img: 54px;
      --offset-x: 0px;
      --offset-y: 0px;
      position:relative; width:var(--sz); height:var(--sz);
      border-radius:50%; margin:16px auto 0;
      display:flex; align-items:center; justify-content:center;
      transform: translate(var(--offset-x), var(--offset-y));
    }
    .glow::before{
      content:""; position:absolute; inset:calc(-0.18 * var(--sz));
      border-radius:inherit; pointer-events:none;
      animation:pulse 2.2s ease-in-out infinite;
      background: radial-gradient(circle at 50% 50%, var(--g1) 0%, var(--g2) 45%, transparent 72%);
      box-shadow: 0 0 calc(0.36 * var(--sz)) var(--s1), 0 0 calc(1.0 * var(--sz)) var(--s2);
    }
    .glow img{ width:var(--img); height:var(--img); border-radius:12px; position:relative; z-index:1; }

    .glow.violet{ --g1: rgba(var(--violet1),.40); --g2: rgba(var(--violet1),.10); --s1: rgba(var(--violet1),.45); --s2: rgba(var(--violet2),.30); }
    .glow.gold  { --g1: rgba(var(--gold),.42);   --g2: rgba(var(--gold),.12);   --s1: rgba(var(--gold),.45);   --s2: rgba(var(--gold),.32); }

    @keyframes pulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.07)} }

    /* stack for roadmap chips */
    .glow-stack{
      margin-top:12px; display:flex; flex-direction:column; align-items:center; gap:18px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a class="logo" href="{{ APP_BASE_URL or '/' }}" title="Back"
         onclick="try{history.back();}catch(_){/*fallback*/}">
        <img src="/static/izzapay-word.svg" alt="IZZA PAY">
      </a>

      <div class="top-cta" style="grid-column:1 / -1; width:100%">
        <button id="roadmapBtn" class="cta" type="button" aria-haspopup="dialog" aria-controls="roadmapModal">
          <img src="/static/izzapay-mark.svg" alt="" aria-hidden="true">
          View Mainnet Roadmap
        </button>
      </div>

      <div>
        <h1>IZZA â€” Test Token Showcase</h1>
        <p class="lead">Issuer, distributor, balances and activity on Pi Testnet.</p>
      </div>
      <div class="spacer"></div>
    </header>

    <section class="hero">
      <!-- LEFT: main token summary -->
      <div class="panel" style="position:relative;overflow:hidden">
        <div class="bg-weave" aria-hidden="true"></div>

        <div class="token-row">
          <!-- Main coin image with SMALLER glow. Tweak only these 3 vars if desired. -->
          <div
            class="token-img"
            id="coinWrap"
            style="
              --pulse-size: 80px;   /* size of glow */
              --pulse-offset-x: -48px; /* left/right (negative = left) */
              --pulse-offset-y: -27px; /* up/down (negative = up) */
            ">
            <img id="coinImg" src="{{ url_for('serve_assets', filename='izza.png') }}" alt="IZZA token">
          </div>

          <!-- Pulsing mark opens the roadmap modal -->
          <div class="side-badge">
            <button id="badgeOpen" class="mark-wrap" type="button" title="Open Mainnet Roadmap">
              <img src="/static/izzapay-mark.svg" alt="IZZA mark">
            </button>
            <div class="arcade">Spin the coin</div>
            <div class="hint">(to refresh data)</div>
          </div>

          <div class="meta">
            <h2>IZZA <span style="opacity:.65">({{ ASSET_CODE }})</span></h2>
            <div class="small">Issuer: <span id="issuer" class="mono wrapaddr"></span></div>
            <div class="small" style="margin-top:2px">Distributor: <span id="distributor" class="mono wrapaddr"></span></div>
          </div>
        </div>

        <div class="two" style="margin-top:12px">
          <div class="stat">
            <div class="label">Distributor balance (IZZA)</div>
            <strong id="dist-balance">â€”</strong>
          </div>
          <div class="stat">
            <div class="label">Holders / trustlines</div>
            <strong id="trust-count">â€”</strong>
          </div>
        </div>
      </div>

      <!-- RIGHT: quick details + QR + activity dropdown -->
      <aside class="panel">
        <div class="card-title">
          <strong>Quick details</strong>
          <span class="small-muted">Pi Testnet</span>
        </div>

        <div class="grid">
          <div class="mini">
            <div class="ico"><img src="{{ url_for('serve_assets', filename='izza.png') }}" alt=""></div>
            <div>
              <div class="small-muted">Asset</div>
              <strong>{{ ASSET_CODE }}</strong>
            </div>
          </div>

          <div class="mini">
            <div class="ico purple"><img src="{{ url_for('serve_assets', filename='izza.png') }}" alt=""></div>
            <div>
              <div class="small-muted">Issuer</div>
              <div id="issuer-compact" class="mono" style="font-size:12px"></div>
            </div>
          </div>

          <div class="mini">
            <div class="ico">ðŸ§¬</div>
            <div>
              <div class="small-muted">Origin</div>
              <div class="mono" style="font-size:12px">izzapay.onrender.com</div>
            </div>
          </div>

          <div class="mini">
            <div class="ico purple">ðŸ§©</div>
            <div>
              <div class="small-muted">Network</div>
              <div class="mono" style="font-size:12px">Pi Testnet</div>
            </div>
          </div>
        </div>

        <hr class="sep">

        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
          <div>
            <div class="small-muted">Distributor</div>
            <div id="d-short" class="mono" style="font-size:12px"></div>
          </div>
          <div style="text-align:right">
            <div class="small-muted" style="margin-bottom:6px">Scan to add</div>
            <img id="qrimg" src="" alt="QR" width="120" height="120" style="border-radius:12px">
            <div class="small-muted" style="margin-top:6px;font-size:12px;max-width:220px">
              When this feature becomes available through Pi Network, youâ€™ll be able to add this token using this QR code.
            </div>
          </div>
        </div>

        <details class="activity">
          <summary>Recent activity</summary>
          <div class="ops" id="recentOps">Loadingâ€¦</div>
        </details>
      </aside>
    </section>

    <section class="lower">
      <div class="panel">
        <h3 style="margin:0 0 8px 0">Raw data & quick links</h3>
        <p class="small-muted" style="margin:4px 0 10px">Open Pi Testnet Horizon endpoints directly.</p>
        <div class="btnrow">
          <a class="linkbtn" id="link-account" href="#" target="_blank" rel="noopener">Distributor account</a>
          <a class="linkbtn" id="link-payments" href="#" target="_blank" rel="noopener">Payments</a>
          <a class="linkbtn" id="link-ops" href="#" target="_blank" rel="noopener">Operations</a>
          <a class="linkbtn" id="link-assets" href="#" target="_blank" rel="noopener">Asset lookup</a>
        </div>
      </div>

      <div class="panel">
        <h3 style="margin:0 0 8px 0">Developer notes</h3>
        <div class="small-muted" style="margin-bottom:10px">
          Issuer / distributor details and last operations from Pi Testnet. This page is a showcase and diagnostic view for the token.
        </div>

        <div>
          <div class="small-muted">Deep Link</div>
          <pre style="margin-top:8px;white-space:pre-wrap;word-break:break-all;font-family:var(--mono);background:transparent;border:1px dashed rgba(255,255,255,.08);padding:10px;border-radius:10px" id="deepPre"></pre>
        </div>
      </div>
    </section>

    <footer>IZZA PAY â€” Testnet showcase Â· Built for demo & diagnostics</footer>
  </div>

  <!-- Modal Backdrop + Roadmap Modal -->
  <div class="modal-backdrop" id="modalBackdrop" hidden></div>
  <div class="modal" id="roadmapModal" role="dialog" aria-modal="true" aria-labelledby="roadmapTitle" hidden>
    <div class="modal-card">
      <div class="modal-header">
        <div class="modal-title">
          <img src="/static/izzapay-mark.svg" alt="">
          <span id="roadmapTitle">MAINNET ROADMAP</span>
        </div>
        <button class="close-btn" type="button" id="closeModalBtn">Close</button>
      </div>
      <div class="modal-body">
        <span class="pill">Total Supply Target: 33.33 Billion (Mainnet)</span>

        <div class="road-grid" style="margin-top:12px">
          <div class="blox">
            <h4>Why a Token at All?</h4>
            <p>IZZA Coins power gameplay. <strong>IZZA Token</strong> powers the ecosystem.</p>
            <ul class="list">
              <li><strong>Governance</strong>: Vote on new mini-games, IZZA City expansions, creator marketplace rules.</li>
              <li><strong>Staking</strong>: Stake tokens to earn boosted Crafting Credits / seasonal IZZA Coin boosts.</li>
              <li><strong>Access</strong>: Token-gated drops, rare blueprints, early creator tools.</li>
              <li><strong>Biz Utility</strong>: Merchant fee discounts and premium IZZA Pay tiers for holders.</li>
              <li><strong>Dev Listing</strong>: Arcade listings prioritized via stake + quality score.</li>
            </ul>

            <div class="img-row" style="margin-top:10px">
              <img src="{{ url_for('serve_assets', filename='izza.png') }}" alt="IZZA coin">
              <img src="/static/izzapay-mark.svg" alt="IZZA mark">
            </div>
          </div>

          <div class="blox">
            <h4>Economy Layering</h4>
            <div class="grid-2">
              <div class="statline">
                <div class="mini-mark" aria-hidden="true" style="font-size:18px;line-height:1">ðŸ‘¾</div>
                <div><strong>IZZA Coins</strong><div class="small" style="color:var(--muted)">Soft in-game currency</div></div>
              </div>
              <div class="statline">
                <div class="mini-mark">ðŸ’Ž</div>
                <div><strong>Crafting Credits</strong><div class="small" style="color:var(--muted)">Premium consumable via Pi</div></div>
              </div>
              <!-- Same card, centered under the two -->
              <div class="statline center-span">
                <div class="mini-mark"><img src="{{ url_for('serve_assets', filename='izza.png') }}" alt="" style="width:18px;height:18px"></div>
                <div style="text-align:center;width:100%">
                  <strong>IZZA Token</strong>
                  <div class="small" style="color:var(--muted)">Scarce, stake + govern</div>
                </div>
              </div>
            </div>
            <p style="margin-top:10px">Peg reference stays for in-game economics (2,000 Coins â‰ˆ 1 Pi). Token remains <em>non-inflationary</em> with utility via staking + access.</p>
          </div>
        </div>

        <div class="blox" style="margin-top:12px">
          <h4>Distribution Plan (Illustrative)</h4>
          <div class="grid-2">
            <ul class="list">
              <li><strong>40%</strong> Growth: public sale + staking rewards</li>
              <li><strong>25%</strong> Ecosystem: new games, marketplace, tools</li>
              <li><strong>20%</strong> Team: 12-month cliff, 36-month vest</li>
              <li><strong>10%</strong> Partners: merchants, collabs</li>
              <li><strong>5%</strong> Community: airdrops for early testers</li>
            </ul>
            <div>
              <p style="margin:4px 0 0 0;color:#cfe0ff">
                Vesting &amp; emissions published on-chain. Staking yields are dynamic and balanced vs. arcade earnings to avoid inflation shocks.
              </p>

              <!-- Smaller, tidy glow chips -->
              <div class="glow-stack" style="margin-top:14px;">
                <div class="glow violet"
                     style="--sz: 86px; --img: 48px; --offset-x: 0px; --offset-y: -4px;">
                  <img src="/static/izzapay-mark.svg" alt="">
                </div>
                <div class="glow gold"
                     style="--sz: 92px; --img: 52px; --offset-x: 0px; --offset-y: -2px;">
                  <img src="{{ url_for('serve_assets', filename='izza.png') }}" alt="IZZA coin">
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="blox" style="margin-top:12px">
          <h4>Launch Roadmap</h4>
          <ul class="list">
            <li><strong>Phase 1 â€” Testnet Live</strong>: Issuer/distributor diagnostics, faucet & trustlines, IZZA City + Arcade earn loop validated.</li>
            <li><strong>Phase 2 â€” Staking Beta</strong>: Token staking â†’ soft boosts to Crafting Credit earnings, seasonal badges, holder quests.</li>
            <li><strong>Phase 3 â€” Governance v1</strong>: On-chain votes for new Arcade titles, blueprint rarity schedules, and marketplace fees.</li>
            <li><strong>Phase 4 â€” Merchant Utility</strong>: IZZA Pay fee rebates for holders, business dashboards with token-gated promos.</li>
            <li><strong>Phase 5 â€” Mainnet Mint (33.33B)</strong>: Final supply + vesting on chain, liquidity bootstrapping, cross-ecosystem creator drops.</li>
          </ul>
        </div>

        <div class="blox" style="margin-top:12px">
          <h4>Value Loop</h4>
          <p>Players earn Coins â†’ buy Crafting Credits (via Pi) â†’ craft & trade â†’ creators/merchants thrive. <strong>IZZA Token</strong> captures upside by governing, staking, and unlocking the best parts of the ecosystem.</p>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // Jinja
  const ASSET_CODE  = "{{ ASSET_CODE }}";
  const ISSUER      = "{{ ISSUER }}";
  const DISTRIBUTOR = "{{ DISTRIBUTOR }}";
  const API_BASE    = "{{ API_BASE }}";
  const DEEP_LINK   = "{{ DEEP_LINK }}";

  // DOM refs
  const issuerEl       = document.getElementById('issuer');
  const distributorEl  = document.getElementById('distributor');
  const distBalanceEl  = document.getElementById('dist-balance');
  const trustCountEl   = document.getElementById('trust-count');
  const issuerCompact  = document.getElementById('issuer-compact');
  const dshort         = document.getElementById('d-short');
  const qrimg          = document.getElementById('qrimg');
  const deepPre        = document.getElementById('deepPre');
  const recentOpsEl    = document.getElementById('recentOps');

  issuerEl.textContent = ISSUER;
  distributorEl.textContent = DISTRIBUTOR;
  issuerCompact.textContent = ISSUER.slice(0,6) + 'â€¦' + ISSUER.slice(-6);
  dshort.textContent = DISTRIBUTOR.slice(0,8) + 'â€¦' + DISTRIBUTOR.slice(-6);
  deepPre.textContent = DEEP_LINK;

  const accountUrl = `${API_BASE}/accounts/${DISTRIBUTOR}`;
  document.getElementById('link-account').href  = accountUrl;
  document.getElementById('link-payments').href = `${accountUrl}/payments`;
  document.getElementById('link-ops').href      = `${accountUrl}/operations`;
  document.getElementById('link-assets').href   = `${API_BASE}/assets?asset_code=${encodeURIComponent(ASSET_CODE)}&asset_issuer=${encodeURIComponent(ISSUER)}`;

  // QR
  const qrData = encodeURIComponent(DEEP_LINK);
  qrimg.src = `https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=${qrData}`;

  // spin-to-refresh
  const coin = document.getElementById('coinImg');
  const wrap = document.getElementById('coinWrap');
  let startX=0, startT=0;
  function start(e){ const p = e.touches ? e.touches[0] : e; startX=p.clientX; startT=performance.now(); }
  function end(e){
    const p = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : e;
    const dx = (p.clientX - startX);
    const dt = Math.max(1, performance.now() - startT);
    const speed = Math.abs(dx) / dt;
    if (speed > 0.4) {
      coin.classList.remove('spin-anim'); void coin.offsetWidth; coin.classList.add('spin-anim');
      setTimeout(fetchSummary, 1100);
    }
  }
  wrap.addEventListener('pointerdown', start, {passive:true});
  wrap.addEventListener('pointerup',   end,   {passive:true});
  wrap.addEventListener('touchstart',  start, {passive:true});
  wrap.addEventListener('touchend',    end,   {passive:true});

  async function fetchSummary(){
    try{
      const [acctRes, holdersRes, opsRes] = await Promise.all([
        fetch(`${API_BASE}/accounts/${DISTRIBUTOR}`),
        fetch(`${API_BASE}/accounts?asset=${encodeURIComponent(ASSET_CODE)}:${encodeURIComponent(ISSUER)}`),
        fetch(`${API_BASE}/accounts/${DISTRIBUTOR}/operations?limit=6&order=desc`)
      ]);
      const acctJson = acctRes.ok ? await acctRes.json() : null;
      const holders  = holdersRes.ok ? await holdersRes.json() : null;
      const opsJson  = opsRes.ok ? await opsRes.json() : null;

      let izzaBal = '0';
      if (acctJson && Array.isArray(acctJson.balances)) {
        const line = acctJson.balances.find(b => b.asset_type !== 'native' && b.asset_code === ASSET_CODE && b.asset_issuer === ISSUER);
        izzaBal = line ? String(line.balance) : '0';
      }
      distBalanceEl.textContent = izzaBal;

      let count = 0;
      if (holders && holders._embedded && holders._embedded.records) {
        count = holders._embedded.records.length || 0;
      }
      trustCountEl.textContent = count;

      let opsHtml = '';
      const recs = opsJson && opsJson._embedded ? opsJson._embedded.records : [];
      if (recs && recs.length){
        recs.forEach(op=>{
          const t = op.type || 'operation';
          const when = op.created_at ? new Date(op.created_at).toLocaleString() : '';
          const msg = (op.asset_code ? op.asset_code : (op.asset || 'native')) + (op.to ? ` â†’ ${op.to.slice(0,8)}â€¦` : '');
          opsHtml += `<div class="op"><span class="t">${t}</span><div class="m">${msg}</div><div class="m">${when}</div></div>`;
        });
      } else { opsHtml = '<div class="m">No recent activity.</div>'; }
      recentOpsEl.innerHTML = opsHtml;

    } catch(e){
      distBalanceEl.textContent = 'â€”';
      trustCountEl.textContent  = 'â€”';
      recentOpsEl.textContent   = 'Error loading recent activity';
    }
  }
  fetchSummary();

  // Modal wiring
  const roadmapBtn    = document.getElementById('roadmapBtn');
  const badgeOpen     = document.getElementById('badgeOpen');
  const modal         = document.getElementById('roadmapModal');
  const backdrop      = document.getElementById('modalBackdrop');
  const closeModalBtn = document.getElementById('closeModalBtn');
  let lastFocus = null;

  function openModal(){
    lastFocus = document.activeElement;
    modal.hidden = false; backdrop.hidden = false;
    modal.setAttribute('open',''); backdrop.setAttribute('open','');
    document.body.style.overflow = 'hidden';
    closeModalBtn.focus();
  }
  function closeModal(){
    modal.removeAttribute('open'); backdrop.removeAttribute('open');
    modal.hidden = true; backdrop.hidden = true;
    document.body.style.overflow = '';
    if (lastFocus && lastFocus.focus) lastFocus.focus();
  }
  roadmapBtn.addEventListener('click', openModal);
  badgeOpen.addEventListener('click', openModal);
  closeModalBtn.addEventListener('click', closeModal);
  backdrop.addEventListener('click', closeModal);
  window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeModal(); });

  // focus trap
  modal.addEventListener('keydown', (e)=>{
    if(e.key !== 'Tab') return;
    const f = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    if(!f.length) return;
    const first = f[0], last = f[f.length - 1];
    if(e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
    else if(!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
  });
})();
</script>
</body>
</html>
