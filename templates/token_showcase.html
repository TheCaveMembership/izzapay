<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IZZA Token ‚Äî Testnet Showcase</title>
  <meta name="description" content="IZZA (test) ‚Äî token showcase for IZZA PAY / IZZA Game" />

  <style>
    :root{
      --bg:#050308;
      --panel:#0b0b10;
      --muted:#9aa0b1;
      --accent1:#7a44ff;
      --accent2:#b784ff;
      --glass: rgba(255,255,255,0.04);
      --card-radius:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
    }

    /* Base */
    html,body{height:100%;margin:0;background:#000;color:#fff;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      -webkit-font-smoothing:antialiased}
    .wrap{max-width:1000px;margin:0 auto;padding:18px 16px 28px}

    @media (min-width:420px){ .wrap{padding:22px 18px 36px} }
    @media (min-width:820px){ .wrap{padding:28px 24px 42px} }

    header{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .logo{width:64px;height:64px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center}
    .logo img{width:100%;height:100%;object-fit:contain;border-radius:12px;background:transparent}
    h1{margin:0;font-size:clamp(20px,4.8vw,28px);letter-spacing:.2px}
    p.lead{color:var(--muted);margin:4px 0 0;font-size:clamp(13px,3.4vw,14px)}
    .back{margin-left:auto}
    .ghost{display:inline-block;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);color:#cfe0ff;text-decoration:none;font-weight:600}

    /* Hero: 1 col on mobile, 2 cols on >= 880px */
    .hero{
      position:relative;
      margin-top:16px;
      display:grid; gap:14px;
      grid-template-columns:1fr;
    }
    @media (min-width:880px){
      .hero{grid-template-columns:minmax(0,1fr) 370px; gap:16px}
    }

    .panel{
      background:var(--panel);
      border:1px solid rgba(255,255,255,.06);
      border-radius:var(--card-radius);
      padding:14px;
      box-shadow:0 4px 30px rgba(0,0,0,.35);
    }
    @media (min-width:540px){ .panel{padding:16px} }
    @media (min-width:980px){ .panel{padding:18px} }

    /* Token row */
    .token-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .token-img{
      width:112px;height:112px; border-radius:14px;
      display:flex;align-items:center;justify-content:center;
      /* no purple box; image floats on animated background */
      background:transparent;
      position:relative;
      isolation:isolate;
    }
    .token-img img{width:100%;height:100%;object-fit:contain;border-radius:14px}

    /* Animated web3 background behind the hero area */
    .bg-weave{
      position:absolute; inset:-4px; z-index:-1; border-radius:20px;
      background:
        radial-gradient(600px 220px at 10% -10%, rgba(122,68,255,.18), transparent 60%),
        radial-gradient(500px 200px at 110% 10%, rgba(183,132,255,.22), transparent 58%),
        radial-gradient(800px 260px at 50% 120%, rgba(255,255,255,.06), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      overflow:hidden;
    }
    .bg-weave::after{
      /* subtle animated stripes */
      content:""; position:absolute; inset:0;
      background:
        repeating-linear-gradient( 110deg,
          rgba(255,255,255,.04) 0px, rgba(255,255,255,.04) 1px,
          rgba(255,255,255,0) 1px, rgba(255,255,255,0) 8px );
      mix-blend-mode:overlay;
      animation: drift 12s linear infinite;
      opacity:.35;
    }
    @keyframes drift {
      0%   { transform: translate3d(-30px,0,0) }
      100% { transform: translate3d(30px,0,0) }
    }

    .meta h2{margin:0 0 4px 0;font-size:clamp(18px,4.6vw,22px)}
    .small{color:var(--muted);font-size:clamp(12px,3.2vw,13px)}
    .mono{font-family:var(--mono)}

    .two{
      margin-top:12px;
      display:grid; gap:10px;
      grid-template-columns:1fr 1fr;
    }
    @media (max-width:480px){
      .two{grid-template-columns:1fr} /* wrap cleanly on small phones */
    }
    .stat{background:var(--glass); border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:10px}
    .stat .label{color:var(--muted); font-size:12px}
    .stat strong{display:block;margin-top:4px;font-size:clamp(16px,4.8vw,18px)}

    /* Right panel details */
    .card-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .small-muted{color:var(--muted);font-size:13px}

    .grid{
      display:grid; gap:10px;
      grid-template-columns:1fr 1fr;
    }
    @media (max-width:480px){
      .grid{grid-template-columns:1fr}
    }
    .mini{display:flex;gap:10px;align-items:center}
    .mini .ico{
      width:36px;height:36px;border-radius:8px;
      display:flex;align-items:center;justify-content:center;
      background:rgba(255,255,255,.04);
    }
    .mini img{width:26px;height:26px;object-fit:contain}

    hr.sep{margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.06)}

    /* Lower section */
    .lower{
      margin-top:14px;
      display:grid; gap:12px;
      grid-template-columns:1fr;
    }
    @media (min-width:880px){
      .lower{grid-template-columns:minmax(0,1fr) 370px}
    }

    .btnrow{display:flex;gap:8px;flex-wrap:wrap}
    .linkbtn{display:inline-block;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);color:#cfe0ff;text-decoration:none;font-weight:600}

    footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true">
        <img src="{{ url_for('serve_assets', filename='izza.png') }}" alt="IZZA">
      </div>
      <div>
        <h1>IZZA ‚Äî Test Token Showcase</h1>
        <p class="lead">Issuer, distributor, balances and activity on Pi Testnet.</p>
      </div>
      <div class="back">
        <a class="ghost" href="{{ APP_BASE_URL or '/' }}">Back</a>
      </div>
    </header>

    <section class="hero">
      <!-- LEFT: main token summary -->
      <div class="panel" style="position:relative;overflow:hidden">
        <div class="bg-weave" aria-hidden="true"></div>

        <div class="token-row">
          <div class="token-img">
            <img src="{{ url_for('serve_assets', filename='izza.png') }}" alt="IZZA token">
          </div>
          <div class="meta">
            <h2>IZZA <span style="opacity:.65">({{ ASSET_CODE }})</span></h2>
            <div class="small">Issuer: <span id="issuer" class="mono"></span></div>
            <div class="small" style="margin-top:2px">Distributor: <span id="distributor" class="mono"></span></div>
          </div>
        </div>

        <div class="two" style="margin-top:12px">
          <div class="stat">
            <div class="label">Distributor balance (IZZA)</div>
            <strong id="dist-balance">‚Äî</strong>
          </div>
          <div class="stat">
            <div class="label">Holders / trustlines</div>
            <strong id="trust-count">‚Äî</strong>
          </div>
        </div>
      </div>

      <!-- RIGHT: quick details + QR -->
      <aside class="panel">
        <div class="card-title">
          <strong>Quick details</strong>
          <span class="small-muted">Pi Testnet</span>
        </div>

        <div class="grid">
          <div class="mini">
            <div class="ico"><img src="{{ url_for('serve_assets', filename='izza.png') }}" alt=""></div>
            <div>
              <div class="small-muted">Asset</div>
              <strong>{{ ASSET_CODE }}</strong>
            </div>
          </div>

          <div class="mini">
            <div class="ico"><img src="{{ url_for('serve_assets', filename='izza.png') }}" alt=""></div>
            <div>
              <div class="small-muted">Issuer</div>
              <div id="issuer-compact" class="mono" style="font-size:12px"></div>
            </div>
          </div>

          <div class="mini">
            <div class="ico">üè∑Ô∏è</div>
            <div>
              <div class="small-muted">Origin</div>
              <div class="mono" style="font-size:12px">izzapay.onrender.com</div>
            </div>
          </div>

          <div class="mini">
            <div class="ico">üî¨</div>
            <div>
              <div class="small-muted">Network</div>
              <div class="mono" style="font-size:12px">Pi Testnet</div>
            </div>
          </div>
        </div>

        <hr class="sep">

        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
          <div>
            <div class="small-muted">Distributor</div>
            <div id="d-short" class="mono" style="font-size:12px"></div>
          </div>
          <div style="text-align:right">
            <div class="small-muted" style="margin-bottom:6px">Scan to add</div>
            <img id="qrimg" src="" alt="QR" width="120" height="120" style="border-radius:12px">
            <div class="small-muted" style="margin-top:6px;font-size:12px;max-width:220px">
              When this feature becomes available through Pi Network, you‚Äôll be able to add this token using this QR code.
            </div>
          </div>
        </div>
      </aside>
    </section>

    <section class="lower">
      <!-- Left: quick links (no raw JSON dump) -->
      <div class="panel">
        <h3 style="margin:0 0 8px 0">Raw data & quick links</h3>
        <p class="small-muted" style="margin:4px 0 10px">Open Pi Testnet Horizon endpoints directly.</p>
        <div class="btnrow">
          <a class="linkbtn" id="link-account" href="#" target="_blank" rel="noopener">Distributor account</a>
          <a class="linkbtn" id="link-payments" href="#" target="_blank" rel="noopener">Payments</a>
          <a class="linkbtn" id="link-ops" href="#" target="_blank" rel="noopener">Operations</a>
          <a class="linkbtn" id="link-assets" href="#" target="_blank" rel="noopener">Asset lookup</a>
        </div>
      </div>

      <!-- Right: developer notes + deep link -->
      <div class="panel">
        <h3 style="margin:0 0 8px 0">Developer notes</h3>
        <div class="small-muted" style="margin-bottom:10px">
          Issuer / distributor details and last operations from Pi Testnet. This page is a showcase and diagnostic view for the token.
        </div>

        <div>
          <div class="small-muted">Deep Link</div>
          <pre style="margin-top:8px;white-space:pre-wrap;word-break:break-all;font-family:var(--mono);background:transparent;border:1px dashed rgba(255,255,255,.08);padding:10px;border-radius:10px" id="deepPre"></pre>
        </div>
      </div>
    </section>

    <footer>IZZA PAY ‚Äî Testnet showcase ¬∑ Built for demo & diagnostics</footer>
  </div>

<script>
(() => {
  // Server-provided values (Jinja)
  const ASSET_CODE  = "{{ ASSET_CODE }}";
  const ISSUER      = "{{ ISSUER }}";
  const DISTRIBUTOR = "{{ DISTRIBUTOR }}";
  const API_BASE    = "{{ API_BASE }}";
  const DEEP_LINK   = "{{ DEEP_LINK }}";

  // DOM refs
  const issuerEl       = document.getElementById('issuer');
  const distributorEl  = document.getElementById('distributor');
  const distBalanceEl  = document.getElementById('dist-balance');
  const trustCountEl   = document.getElementById('trust-count');
  const issuerCompact  = document.getElementById('issuer-compact');
  const dshort         = document.getElementById('d-short');
  const qrimg          = document.getElementById('qrimg');
  const deepPre        = document.getElementById('deepPre');

  // Init text
  issuerEl.textContent = ISSUER;
  distributorEl.textContent = DISTRIBUTOR;
  issuerCompact.textContent = ISSUER.slice(0,6) + '‚Ä¶' + ISSUER.slice(-6);
  dshort.textContent = DISTRIBUTOR.slice(0,8) + '‚Ä¶' + DISTRIBUTOR.slice(-6);
  deepPre.textContent = DEEP_LINK;

  // Quick external links
  const accountUrl = `${API_BASE}/accounts/${DISTRIBUTOR}`;
  document.getElementById('link-account').href  = accountUrl;
  document.getElementById('link-payments').href = `${accountUrl}/payments`;
  document.getElementById('link-ops').href      = `${accountUrl}/operations`;
  document.getElementById('link-assets').href   = `${API_BASE}/assets?asset_code=${encodeURIComponent(ASSET_CODE)}&asset_issuer=${encodeURIComponent(ISSUER)}`;

  // QR (pointing at the deep link; will become useful when Pi enables it)
  const qrData = encodeURIComponent(DEEP_LINK);
  qrimg.src = `https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=${qrData}`;

  // Fetch distributor account + holders count + (optionally) recent ops count
  async function fetchSummary(){
    try{
      const [acctRes, holdersRes] = await Promise.all([
        fetch(`${API_BASE}/accounts/${DISTRIBUTOR}`),
        fetch(`${API_BASE}/accounts?asset=${encodeURIComponent(ASSET_CODE)}:${encodeURIComponent(ISSUER)}`)
      ]);
      const acctJson = acctRes.ok ? await acctRes.json() : null;
      const holders  = holdersRes.ok ? await holdersRes.json() : null;

      // Distributor balance for IZZA
      let izzaBal = '0';
      if (acctJson && Array.isArray(acctJson.balances)) {
        const line = acctJson.balances.find(b => b.asset_type !== 'native' && b.asset_code === ASSET_CODE && b.asset_issuer === ISSUER);
        izzaBal = line ? String(line.balance) : '0';
      }
      distBalanceEl.textContent = izzaBal;

      // simple trustline count (records length)
      let count = 0;
      if (holders && holders._embedded && holders._embedded.records) {
        count = holders._embedded.records.length || 0;
      }
      trustCountEl.textContent = count;
    } catch(e){
      distBalanceEl.textContent = '‚Äî';
      trustCountEl.textContent  = '‚Äî';
    }
  }

  fetchSummary();
})();
</script>
</body>
</html>
