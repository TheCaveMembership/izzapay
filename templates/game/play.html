<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>IZZA GAME — Play</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <link rel="stylesheet" href="/static/themes.css">
  <style>
    :root{ --ui:rgba(255,255,255,.9); --bg0:#0b0f17; --card:#141a23; --line:#263042; }
    html,body{height:100%; margin:0; background:#0b0f17; color:#e8eef7; font-family:Arial,Helvetica,sans-serif}
    *{ -webkit-user-select:none; user-select:none; -webkit-touch-callout:none; }
    canvas{ touch-action:none; }

    .wrap{max-width:1100px;margin:0 auto;padding:8px}
    .hud{ position:sticky; top:0; z-index:5; display:flex; align-items:center; justify-content:space-between;
      background:rgba(10,12,18,.75); backdrop-filter:blur(8px); padding:8px 10px; border-bottom:1px solid var(--line) }
    .hud .left{display:flex;gap:12px;align-items:center}
    .hud .pill{background:#1b2433; border:1px solid var(--line); padding:6px 10px; border-radius:10px; font-size:13px}
    .hud .stars{display:flex; gap:4px}
    .star{width:16px; height:16px; border:1px solid #445; border-radius:3px; background:#111}
    .star.on{background:#ffd23f; border-color:#c59b00}

    #gameCard{background:var(--card); border:1px solid var(--line); border-radius:14px; padding:10px; margin-top:10px; position:relative}
    #game{display:block; width:100%; height:auto; border-radius:12px; background:#000}
    #prompt { position:absolute; transform:translate(-50%,-120%); padding:4px 8px; font-size:12px;
      background:#0b0f17; border:1px solid #263042; border-radius:8px; display:none; pointer-events:none }

    .mini{ position:fixed; right:12px; bottom:118px; z-index:6;
      background:rgba(10,12,18,.75); border:1px solid var(--line); border-radius:14px; padding:8px }
    #minimap{ width:240px; height:auto; display:block; border-radius:10px; background:#0b0f17 }

    .controls{ position:fixed; right:12px; bottom:14px; z-index:6; display:flex; gap:8px; align-items:center }
    .btn{ background:#162134; color:#cfe0ff; border:1px solid #2a3550; border-radius:10px; padding:10px 12px; font-size:14px; }

    .stick { position:fixed; left:12px; bottom:12px; width:120px; height:120px; z-index:6; touch-action:none }
    .stick .base{ position:absolute; inset:0; border-radius:60px; background:rgba(255,255,255,.07); border:1px solid #2a3550 }
    .stick .nub{ position:absolute; left:40px; top:40px; width:40px; height:40px; border-radius:20px; background:#1f2a3f; border:1px solid #2a3550 }
    @media (min-width:820px){ .stick{ display:none; } }

    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:20; }
    .modal .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.55); }
    .modal .card{ position:relative; background:#121827; border:1px solid #2a3550; border-radius:14px; padding:16px; width:min(520px,92vw); color:#e8eef7 }
    .modal .card h3{ margin:0 0 8px }
    .modal .row{ display:flex; gap:10px; justify-content:flex-end; margin-top:12px }
    .ghost{ background:transparent; color:#cfe0ff; border:1px solid #394769; border-radius:10px; padding:8px 10px }

    /* Shop UI bits */
    .shop-list{ display:flex; flex-direction:column; gap:8px; }
    .shop-item{ display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px; background:#0f1522; border:1px solid #2a3550; border-radius:10px; }
    .shop-item .meta .name{ font-weight:600 }
    .shop-item .meta .sub{ opacity:.8; font-size:12px }
    .shop-item .buy{ background:#1f2a3f; color:#cfe0ff; border:1px solid #2a3550; border-radius:8px; padding:6px 10px }
    .shop-note{ opacity:.8; font-size:12px; margin-top:6px }
    .pill.coins{ background:#1b2433; border:1px solid var(--line); padding:6px 10px; border-radius:10px; font-size:13px }
  </style>
</head>
<body class="cw-blue theme-a">
  <div class="wrap">
    <div class="hud">
      <div class="left">
        <div class="pill">IZZA GAME</div>
        <div class="pill">Player: {{ user.username }}</div>
        <div class="pill coins">Coins: <span id="coins">0 IC</span></div>
      </div>
      <div class="stars" id="stars">
        <div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div><div class="star"></div>
      </div>
    </div>

    <div id="gameCard">
      <canvas id="game" width="960" height="540" aria-label="IZZA City"></canvas>
      <div id="prompt">Press B to enter</div>
    </div>
  </div>

  <div class="mini" id="miniWrap" title="Tap to open world map">
    <canvas id="minimap" width="260" height="170"></canvas>
  </div>

  <div class="stick" id="stick">
    <div class="base"></div>
    <div class="nub" id="nub"></div>
  </div>
  <div class="controls">
    <button class="btn" id="btnA" type="button">A</button>
    <button class="btn" id="btnB" type="button">B</button>
  </div>

  <div class="modal" id="mapModal">
    <div class="backdrop"></div>
    <div class="card">
      <h3>IZZA City — World Map</h3>
      <canvas id="bigmap" width="700" height="520" style="width:100%;height:auto;border-radius:10px;background:#0b0f17"></canvas>
      <div class="row"><button class="ghost" id="closeMap">Close</button></div>
      <div style="margin-top:8px; font-size:12px; opacity:.85">
        <span style="display:inline-block;width:12px;height:12px;background:#1c293e;border:1px solid #31415d;margin-right:6px;border-radius:3px"></span>Unlocked
        <span style="display:inline-block;width:12px;height:12px;background:rgba(163,176,197,.25);border:1px solid #485771;margin-right:6px;border-radius:3px;margin-left:12px"></span>Preview (semi-transparent)
        <span style="display:inline-block;width:12px;height:12px;background:#000;border:1px solid #2a3140;margin-right:6px;border-radius:3px;margin-left:12px"></span>Locked
      </div>
    </div>
  </div>

  <div class="modal" id="enterModal">
    <div class="backdrop"></div>
    <div class="card">
      <h3>Welcome to The Hub</h3>
      <p>Start the tutorial to learn how to attack. Beat the dummy to complete the mission.</p>
      <div class="row" style="justify-content:space-between">
        <button class="ghost" id="startTutorial">Start Tutorial</button>
        <button class="ghost" id="closeEnter">Close</button>
      </div>
    </div>
  </div>

  <!-- SHOP MODAL -->
  <div class="modal" id="shopModal">
    <div class="backdrop"></div>
    <div class="card">
      <h3>Shop — Cashier</h3>
      <div class="shop-list" id="shopList"></div>
      <div class="shop-note" id="shopNote"></div>
      <div class="row"><button class="ghost" id="closeShop">Close</button></div>
    </div>
  </div>

  <!-- Pass profile to JS and load the engine -->
  <script>window.__IZZA_PROFILE__ = {{ profile|tojson|safe }};</script>
  <script src="/static/game/js/izza_play_v2.js?v=4"></script>
</body>
</html>
