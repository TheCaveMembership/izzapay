<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Street Race â€” IZZA GAME</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  <script>window.IZZA_PERSIST_BASE = 'https://izzagame.onrender.com';</script>
  <script src="/static/game/js/izza-persist.js"></script>

  <link rel="stylesheet" href="/static/themes.css">
  <style>
    body{margin:0;background:#0a0c12;color:#e8eef7;font-family:Arial,Helvetica,sans-serif}
    .arena{position:relative;height:74vh;min-height:560px;border:1px solid rgba(255,255,255,.1);
           border-radius:14px;background:#06080e;overflow:hidden}
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:8;
      background:rgba(0,0,0,.45);}
    .card{background:rgba(0,0,0,.6);border:1px solid rgba(255,255,255,.18);border-radius:14px;padding:16px 18px;
      display:flex;flex-direction:column;gap:10px;align-items:stretch; max-width:680px; width:min(92%,680px)}
    .preview{height:160px;border:1px dashed rgba(255,255,255,.18);border-radius:12px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .startBtn{padding:10px 16px;border-radius:10px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.06);font-weight:800}
    .hud{position:absolute;top:10px;left:10px;z-index:6;color:white;font-size:12px}
    .nitroBtn{position:absolute; right:10px; bottom:14px; z-index:7; border-radius:999px; border:1px solid rgba(255,255,255,.1);
      background:#222; padding:10px 14px; font-weight:800; color:white}
  </style>
</head>
<body>
  <div class="arena" id="arena">
    <!-- HUD -->
    <div class="hud">
      SPEED: <span id="speed">0</span> km/h |
      DIST: <span id="dist">0</span> m |
      COINS: <span id="coinsRun">0</span>
    </div>

    <!-- Garage Overlay -->
    <div id="startOverlay" class="overlay">
      <div class="card">
        <h3>Street Race</h3>
        <div class="preview">
          <img id="garageCar" src="/static/game/sprites/garage/coupe.png" alt="Car preview" style="height:100%"/>
        </div>
        <button id="startBtn" class="startBtn">START</button>
      </div>
    </div>

    <!-- Nitro UI -->
    <button class="nitroBtn" id="nitroBtn">NITRO</button>

    <!-- Game Scene -->
    <canvas id="scene" width="1100" height="760"></canvas>
  </div>

  <script>
  (function(){
    const canvas = document.getElementById('scene');
    const ctx = canvas.getContext('2d');
    let W = canvas.width, H = canvas.height;

    // Load sprites
    const sprites = {
      player: new Image(),
      traffic: [new Image(), new Image()],
      underglow: new Image(),
      bg: new Image()
    };
    sprites.player.src = '/static/game/sprites/player/coupe.png';
    sprites.traffic[0].src = '/static/game/sprites/traffic/red.png';
    sprites.traffic[1].src = '/static/game/sprites/traffic/blue.png';
    sprites.underglow.src = '/static/game/sprites/effects/underglow.png';
    sprites.bg.src = '/static/game/sprites/tracks/night.png';

    const state = {
      running:false, ended:false,
      speed:0, dist:0, px:0,
      nitro:0, coins:0,
      cars:[], items:[]
    };

    function draw(){
      ctx.clearRect(0,0,W,H);
      ctx.drawImage(sprites.bg,0,0,W,H);
      ctx.save();
      ctx.translate(W/2 + state.px*200, H-160);
      ctx.drawImage(sprites.underglow,-120,40,240,40);
      ctx.drawImage(sprites.player,-80,-40,160,80);
      ctx.restore();
    }

    function loop(){
      if(!state.running) return;
      state.speed += (160 - state.speed)*0.1;
      state.dist += state.speed/60;
      document.getElementById('speed').textContent = Math.round(state.speed);
      document.getElementById('dist').textContent = Math.round(state.dist);
      document.getElementById('coinsRun').textContent = state.coins;
      draw();
      requestAnimationFrame(loop);
    }

    document.getElementById('startBtn').addEventListener('click',()=>{
      document.getElementById('startOverlay').style.display='none';
      state.running=true; state.speed=30; state.dist=0;
      loop();
    });
  })();
  </script>
</body>
</html>
